![[Pasted image 20230815230747.png]]
## Master (Built-In)

Есть мастер (контроллер) - сервер, который занимается планированием задач. Он запускает задачи по тому расписанию, которое настроено.

Задачи он запускает на тех агентах, которые к нему прикрепили.

Можно запускать задачи и на самом мастере, но это не рекомендуется загружать контроллер пайплайнами, т.к. могут пойди сбои из-за нехватки места.

Контроллер и только контроллер хранит все логи.

## [](https://github.com/lunaticenslaved/studying/blob/main/jenkins/architecture.md#slave)Slave

### [](https://github.com/lunaticenslaved/studying/blob/main/jenkins/architecture.md#%D1%87%D1%82%D0%BE-%D1%8D%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5)Что это такое

Это ноды (агенты), на которых непосредственно запускаются задачи. Мастер говорит агенту запустить задачу. Агент её выполнит и вернёт результат мастеру. Мастер получит результат и сохранить его в `build`-логе.

### [](https://github.com/lunaticenslaved/studying/blob/main/jenkins/architecture.md#%D1%87%D1%82%D0%BE-%D0%BC%D0%BE%D0%B6%D0%B5%D1%82-%D0%B1%D1%8B%D1%82%D1%8C-slave-%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%BE%D0%BC)Что может быть slave-агентом

`Slave`-агентом может быть любая виндовая или линуксовая машина, виртуальные машины, докер-контейнеры, кубернетес и т.д. Сейчас стараются использовать докер и кубернетес.

Чтобы машина могла быть агентом, она должна соответствовать двум требованиям:

- наличие `Java` на машине
- `ssh` порты открыты и доступны

### [](https://github.com/lunaticenslaved/studying/blob/main/jenkins/architecture.md#%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BA-%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D1%83)Подключение к агенту

Подключиться к агенту можно двумя способами:

- через `ssh` или какие-то креденшэлс. Это рекомендуется, т.к. дженкинс может подключиться к агенту при потере подключения, попробовать пропинговать его и т.д.
- запуск через `agent.jar` - джава-файл агента. Здесь на агентах придётся использовать какие-то костыли, чтобы подключить агента к контроллеру

### [](https://github.com/lunaticenslaved/studying/blob/main/jenkins/architecture.md#best-practice)Best practice

- использовать ssh для подключения
- избегать использования JNLP через браузер
- определяйте tools

### [](https://github.com/lunaticenslaved/studying/blob/main/jenkins/architecture.md#%D0%BA%D0%B0%D0%BA-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0)Как создать агента

Создание агента производится через дженкинс. Указывается:

- название агента
- описание
- количество экзекьюторов (сколько заданий будет запускаться одновременно на агенте. Обычно может соответствовать количеству ядер ЦП. // TODO как это влияет)
- удаленную рабочую директорию
- лейблы (можно указать агенты с определенной меткой, а потом, при создании пайплайнов указывать, что работа может выполняться только на машинах с определенной меткой. Дженкинс сам найдет свободные машины и запустит работу)
- как часто использовать (всегда когда возможно или только когда лейбл совпадает (предпочтительно, чтобы не было ситуаций, когда пайплайн собран под линукс, а запустится на виндовой ноде)).
- метод запуска - каким образом будет запущен агент
- др.

### [](https://github.com/lunaticenslaved/studying/blob/main/jenkins/architecture.md#%D0%BA%D0%B0%D0%BA-%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D1%8C)Как запустить

Чтобы дженкинс мог корректно общаться с агентами, надо чтобы у дженкинса был открыт порт, на которые агенты будут стучаться к контроллеру. Обычно это 50000 порт, который нужно указать в настройках дженкинса.