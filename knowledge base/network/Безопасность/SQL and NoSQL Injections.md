## Error trace

Если при запросе выполняется селект по `id`, а пользователь решил вставить немного треша, то веб-сервер вернёт ошибку:
```
ERROR: invalid input syntax for type numeric: "PostgreSQL 8.2.13 on

i386-portbld-freebsd7.2, compiled by GCC cc (GCC) 4.2.1 20070719 [FreeBSD]"  
```
Подобная информация сразу покажет злоумышленнику версию базы данных и что пошло не так. Он даже сможет узнать на какой строчке кода находится ошибка. Информация подобного рода позволяет злоумышленнику начать строить вектор атаки:

- найти уязвимости данной версии и как можно их проэксплуатировать,
- найти самое уязвимое место вашего сервиса.

Для начала — **никогда не возвращайте в продакшн среде подробный стек-трейс ошибки.** Если нет подробной клиентской ошибки, возвращайте пользователям просто “error”.

## Escaping

Если отправить запрос 
```
GET /chats?id=123' or '1'='1
```
то в селект подставится 
```
const sql = "SELECT * FROM chats WHERE id='123' or '1'='1'";
```

То есть на выходе пользователю вернётся не информация по указанному чату, а список всех чатов и всей информации в таблице chats.

Исправить ситуацию можно следующим образом:

- санитайзить или эскейпить данные,
- использовать ORM,
- использовать `prepared statement`.

Эскейпинг помогает решить некоторые частные случаи атак:
```
const { name } = req.body;
const escaped = name.replace('\'', '\'\'');
const sql = "SELECT * FROM chats WHERE name='${escaped}'";
```

Руками эскейпить все вариации сложно, потому часто используют библиотеки для `prepared statement`.
